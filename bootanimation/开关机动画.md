
# 开关机动画配置
---

## 展讯9832A平台

**1. 开机动画播完之后黑屏时间太长怎么处理**

新增一个part1文件夹，开机动画播完之后会停止在part1这张图上去。

desc.txt 举例如下：
	
	480 854 15
	c 1 0 part0
	p 0 0 part1

**2. 怎样延长关机时间**
	
**ShutdownThread.java**中作如下修改：

	private static boolean sIsPowerOffAlarm;
	
	//延长关机时间 begin
	private static long mStartShutdownTimesms;
	private static long mEndShutdownTimesms;
	private static long mShutdownTimesms;
	//延长关机时间 end
	
	private ShutdownThread() {
	}
	
	//......

	//延长关机时间 begin
    mStartShutdownTimesms = SystemClock.uptimeMillis();
	//延长关机时间 end

    // Throw up a system dialog to indicate the device is rebooting / shutting down.
    ProgressDialog pd = null;

        if (mRebootHasProgressBar) {
            sInstance.setRebootProgress(MOUNT_SERVICE_STOP_PERCENT, null);

            // If it's to reboot to install an update and uncrypt hasn't been
            // done yet, trigger it now.
            uncrypt();
        }

		//延长关机时间 begin
        mEndShutdownTimesms = SystemClock.uptimeMillis();
        mShutdownTimesms = mEndShutdownTimesms - mStartShutdownTimesms;
        if(mShutdownTimesms < 8 * 1000){
            try {
                Thread.sleep(8 * 1000 - mShutdownTimesms);
            } catch (InterruptedException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }
        }
		//延长关机时间 end

        rebootOrShutdown(mContext, mReboot, mReason);
    }


**3. 开机动画播完之后立马进入Laucher界面**

**frameworks\base\services\core\java\com\android\server\wm\WindowManagerService.java**中作如下修改：

    private static final int BOOT_ANIMATION_CHECK_SPAN = 200;
    private static final int MAX_BOOTANIMATION_WAIT_TIME = 15*1000;
    private final Object mAnimationDoneSync = new Object();



**packages\apps\settings\src\com\android\settings\FallbackHome.java**中作如下修改
	
	//开机动画播完之后立马进入Launcher begin
	import android.os.SystemProperties;

    private boolean userUnlockAndRealHome = false;    
    private final long delayTime = 2*1000;//2s
	//开机动画播完之后立马进入Launcher end

    @Override
    protected void onDestroy() {
        super.onDestroy();
		//开机动画播完之后立马进入Launcher begin
        if (userUnlockAndRealHome){
          Log.d(TAG,"Fallbackhome destory and set the property value to 1");
          new Thread(new Runnable(){
                @Override
                public void run() {
                   try {
                       Thread.sleep(delayTime);
                       SystemProperties.set("service.bootanim.end", "1");
                       Log.d(TAG,"delay 2s set value");
                       } catch (Exception e) {
                       e.printStackTrace();
                   }
                }

            }).start();

          userUnlockAndRealHome = false;
        } 
        Log.d(TAG,"Fallbackhome destory");
		//开机动画播完之后立马进入Launcher end
        unregisterReceiver(mReceiver);
    }

    private void maybeFinish() {
        if (getSystemService(UserManager.class).isUserUnlocked()) {
            final Intent homeIntent = new Intent(Intent.ACTION_MAIN)
                    .addCategory(Intent.CATEGORY_HOME);
            final ResolveInfo homeInfo = getPackageManager().resolveActivity(homeIntent, 0);
            if (Objects.equals(getPackageName(), homeInfo.activityInfo.packageName)) {
                Log.d(TAG, "User unlocked but no home; let's hope someone enables one soon?");
                mHandler.sendEmptyMessageDelayed(0, 500);
            } else {
				//开机动画播完之后立马进入Launcher begin
                userUnlockAndRealHome = true;
				//开机动画播完之后立马进入Launcher end
                Log.d(TAG, "User unlocked and real home found; let's go!");
                finish();
            }
        }
    }